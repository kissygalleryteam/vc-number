KISSY.add("kg/vc-number/1.1.0/plugins/amountInWords/amountInWords",["node","base"],function(e,t,n,r){var a="",l=t("node").all,s=t("base");r.exports=s.extend({pluginInitializer:function(e){var t=this;if(e){var n=e.get("$target");n.attr("data-cn",!0),t.set("vcNumber",e),t.set("$target",e.get("$target")),t._renderHtml(),t._bindEvents()}},pluginDestructor:function(){var e=this,t=e.get("vcNumber");t.detach("beforeChange",e.get("beforeChange")),t.detach("afterChange",e.get("afterChange"));var n=t.get("$target").siblings("."+e.get("cls"));n.length&&n.remove()},_renderHtml:function(){var e=this,t=e.get("$target"),n=e.get("moneyTpl");l(n).insertBefore(t)},_bindEvents:function(){var e=this,t=e.get("vcNumber"),n=function(){},r=function(t){var n=t.input||l(t.currentTarget),r=e.addCommas(n.val());n.val(r);var a=e.get("type"),s=e.get("types");switch(a){case s.cellType:e._renderChineseNumUl();break;case s.wordType:e._renderChineseWords()}};e.set("beforeChange",n),e.set("afterChange",r),t.on("beforeChange",n),t.on("afterChange",r),e.get("$target").on("focus",r);var a=t.get("cls").init,s=t.get("cls").sign,g=e.get("cls");l(document).on("click",function(t){var n=l(t.target);n.hasClass(a)||n.hasClass(g)||n.hasClass(s)||!n.parent()||n.parent().hasClass(s)||e._hideChineseNumUl()})},_hideChineseNumUl:function(){var e=this,t=e.get("$target");t.prev("."+e.get("cls")).fadeOut(.4)},_renderChineseNumUl:function(){var t,n=this,r=n.get("$target"),a=r.prev("."+n.get("cls")),s=["元","十","百","千","万","十","百","千","亿","十","百","千","兆","十","百","千"],g=["角","分"],i=[];l("ul",a).html("");var o=r.val().replace(/\,/g,"");if(o){var h=o.split(".");o=h[0];var c=h[1];if(t=l("li",a).length,o.length+1>t){for(var d=s.slice(t,o.length+1).reverse(),u=[],v=0;v<d.length;v++)u.push("元"==d[v]?'<li style="border-right:none"><div>'+d[v]+"</div><strong></strong></li>":"<li><div>"+d[v]+"</div><strong></strong></li>");l("ul",a).prepend(u.join("")),e.each(e.makeArray(l("li",a)).reverse(),function(e,t){t&&t%3==0&&l(e).addClass("separator")})}if(c&&i.length<2){for(var f=0;f<c.length;f++)i.push('<li style="border-left:2px solid '+n.get("borderColor")+';border-right:none;" class="J_PriceDot"><div>'+g[f]+"</div><strong></strong></li>");l("ul",a).append(i.join(""))}var p=l("strong",a);if(p.html("").removeClass("yen"),c){l(p[p.length-o.length-c.length-1]).html("&yen;").addClass("yen");for(var m=0;m<o.length;m++)l(p[p.length-o.length-c.length+m]).html(o.charAt(m));for(var f=0;f<c.length;f++)l(p[p.length-c.length+f]).html(c.charAt(f))}else l(p[p.length-o.length-1]).html("&yen;").addClass("yen"),e.each(o,function(e,t){l(p[p.length-o.length+t]).html(e)});a.fadeIn(.4),a.width(30*a.children().children().length)}},_renderChineseWords:function(){var e=this,t=e.get("$target"),n=t.prev("."+e.get("cls")),r=e.toCnNumber(t.val());n.replaceClass(e.get("cellMoneyCls"),e.get("cnMoneyCls")),n.html(r+'<span class="unit">元</span>'),n.width(20*(r.length+1)),n.fadeIn(.4)},toCnNumber:function(e){var t=this,n=t._resetNum(e);return t._tempChinese(n)},_tempChinese:function(e){for(var t=new Array("零","壹","贰","叁","肆","伍","陆","柒","捌","玖"),n=new Array("","拾","佰","仟","万","亿","点",""),r=(""+e).replace(/(^0*)/g,"").split("."),a=0,l="",s=r[0].length-1;s>=0;s--){switch(a){case 0:l=n[7]+l;break;case 4:new RegExp("0{4}\\d{"+(r[0].length-s-1)+"}$").test(r[0])||(l=n[4]+l);break;case 8:l=n[5]+l,n[7]=n[5],a=0}a%4==2&&"0"==r[0].charAt(s)&&"0"!=r[0].charAt(s+1)&&(l=t[0]+l),0!=r[0].charAt(s)&&(l=t[r[0].charAt(s)]+n[a%4]+l),a++}if(r.length>1){l+=n[6];for(var s=0;s<r[1].length;s++)l+=t[r[1].charAt(s)]}return l},_resetNum:function(e){var t,n=e.replace(/(\s+)|,/g,"").replace(/(\.+)/g,".").replace(/\,/g,"");return t=/^(\d*)?\d+(\.?)(\d?)(\d?)$/.test(n)?n:!1},addCommas:function(e){var t=this,n=t._resetNum(e);if(!n)return"";n+="";for(var r=n.split("."),a=r[0],l=r.length>1?"."+r[1]:"",s=/(\d+)(\d{3})/;s.test(a);)a=a.replace(s,"$1,$2");return a+l}},{ATTRS:{pluginId:{value:"amountInWords"},type:{value:"inCells"},types:{value:{cellType:"inCells",wordType:"inWords"}},cls:{value:"J_CnMoney"},cnMoneyCls:{value:"cn-money"},cellMoneyCls:{value:"cell-money"},vcNumber:{value:a},beforeChange:{value:a},afterChange:{value:a},moneyTpl:{value:'<div class="J_CnMoney cell-money"><ul></ul></div>'},borderColor:{value:"#fdcc7d"}}})});