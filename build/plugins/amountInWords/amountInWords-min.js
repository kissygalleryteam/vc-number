KISSY.add("kg/vc-number/1.0.0/plugins/amountInWords/amountInWords",["node","base"],function(e,t,n,r){var l="",a=t("node").all,s=t("base");r.exports=s.extend({pluginInitializer:function(e){var t=this;if(e){var n=e.get("$target");n.attr("data-cn",!0),t.set("vcNumber",e),t.set("$target",e.get("$target")),t._renderHtml(),t._bindEvents()}},pluginDestructor:function(){var e=this,t=e.get("vcNumber");t.detach("beforeChange",e.get("beforeChange")),t.detach("afterChange",e.get("afterChange"))},_renderHtml:function(){var e=this,t=e.get("$target"),n=e.get("moneyTpl");a(n).insertBefore(t)},_bindEvents:function(){var e=this,t=e.get("vcNumber"),n=function(){},r=function(t){var n=t.input,r=e.addCommas(n.val());n.val(r);var l=e.get("type"),a=e.get("types");switch(l){case a.cellType:e._renderChineseNumUl();break;case a.wordType:e._renderChineseWords()}};e.set("beforeChange",n),e.set("afterChange",r),t.on("beforeChange",n),t.on("afterChange",r);var l=t.get("cls").init,s=t.get("cls").sign,i=e.get("cls");a(document).on("click",function(t){var n=a(t.target);n.hasClass(l)||n.hasClass(i)||n.hasClass(s)||n.parent().hasClass(s)||e._hideChineseNumUl()})},_hideChineseNumUl:function(){var e=this,t=e.get("$target");t.prev("."+e.get("cls")).fadeOut(.4)},_renderChineseNumUl:function(){var t,n=this,r=n.get("$target"),l=r.prev("."+n.get("cls")),s=["元","十","百","千","万","十","百","千","亿","十","百","千","兆","十","百","千"],i=["角","分"],o=[];a("ul",l).html("");var g=r.val().replace(/\,/g,"");if(g){var h=g.split(".");g=h[0];var c=h[1];if(t=a("li",l).length,g.length+1>t){for(var d=s.slice(t,g.length+1).reverse(),u=[],v=0;v<d.length;v++)u.push("元"==d[v]?'<li style="border-right:none"><div>'+d[v]+"</div><strong></strong></li>":"<li><div>"+d[v]+"</div><strong></strong></li>");a("ul",l).prepend(u.join("")),e.each(e.makeArray(a("li",l)).reverse(),function(e,t){t&&t%3==0&&a(e).addClass("separator")})}if(c&&o.length<2){for(var f=0;f<c.length;f++)o.push('<li style="border-left:1px solid '+n.get("borderColor")+';border-right:none;" class="J_PriceDot"><div>'+i[f]+"</div><strong></strong></li>");a("ul",l).append(o.join(""))}var m=a("strong",l);if(m.html("").removeClass("yen"),c){a(m[m.length-g.length-c.length-1]).html("&yen;").addClass("yen");for(var p=0;p<g.length;p++)a(m[m.length-g.length-c.length+p]).html(g.charAt(p));for(var f=0;f<c.length;f++)a(m[m.length-c.length+f]).html(c.charAt(f))}else a(m[m.length-g.length-1]).html("&yen;").addClass("yen"),e.each(g,function(e,t){a(m[m.length-g.length+t]).html(e)});l.fadeIn(.4),l.width(29*l.children().children().length)}},_renderChineseWords:function(){var e=this,t=e.get("$target"),n=t.prev("."+e.get("cls")),r=e.toCnNumber(t.val());n.replaceClass(e.get("cellMoneyCls"),e.get("cnMoneyCls")),n.html(r+"元"),n.fadeIn(.4)},toCnNumber:function(e){var t=this,n=t._resetNum(e);return t._tempChinese(n)},_tempChinese:function(e){for(var t=new Array("零","壹","贰","叁","肆","伍","陆","柒","捌","玖"),n=new Array("","拾","佰","仟","万","亿","点",""),r=(""+e).replace(/(^0*)/g,"").split("."),l=0,a="",s=r[0].length-1;s>=0;s--){switch(l){case 0:a=n[7]+a;break;case 4:new RegExp("0{4}\\d{"+(r[0].length-s-1)+"}$").test(r[0])||(a=n[4]+a);break;case 8:a=n[5]+a,n[7]=n[5],l=0}l%4==2&&"0"==r[0].charAt(s)&&"0"!=r[0].charAt(s+2)&&(a=t[0]+a),0!=r[0].charAt(s)&&(a=t[r[0].charAt(s)]+n[l%4]+a),l++}if(r.length>1){a+=n[6];for(var s=0;s<r[1].length;s++)a+=t[r[1].charAt(s)]}return a},_resetNum:function(e){var t,n=e.replace(/(\s+)|,/g,"").replace(/(\.+)/g,".").replace(/\,/g,"");return t=/^(\d*)?\d+(\.?)(\d?)(\d?)$/.test(n)?n:!1},addCommas:function(e){var t=this,n=t._resetNum(e);if(!n)return"";n+="";for(var r=n.split("."),l=r[0],a=r.length>1?"."+r[1]:"",s=/(\d+)(\d{3})/;s.test(l);)l=l.replace(s,"$1,$2");return l+a}},{ATTRS:{pluginId:{value:"amountInWords"},type:{value:"inCells"},types:{value:{cellType:"inCells",wordType:"inWords"}},cls:{value:"J_CnMoney"},cnMoneyCls:{value:"cn-money"},cellMoneyCls:{value:"cell-money"},vcNumber:{value:l},beforeChange:{value:l},afterChange:{value:l},moneyTpl:{value:'<div class="J_CnMoney cell-money"><ul></ul></div>'},borderColor:{value:"#fdcc7d"}}})});