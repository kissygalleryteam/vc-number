KISSY.add("kg/vc-number/1.2.0/index",["base","node"],function(e,t,n,a){var r,i,s=t("base"),l=t("node");r=function(t){var n="",a=l.all,r=s;return t=r.extend({pluginInitializer:function(e){var t=this;if(e){var n=e.get("$target");n.attr("data-cn",!0),t.set("vcNumber",e),t.set("$target",e.get("$target")),t._renderHtml(),t._bindEvents()}},pluginDestructor:function(){var e=this,t=e.get("vcNumber");t.detach("beforeChange",e.get("beforeChange")),t.detach("afterChange",e.get("afterChange"));var n=t.get("$target").siblings("."+e.get("cls"));n.length&&n.remove()},_renderHtml:function(){var e=this,t=e.get("$target"),n=e.get("moneyTpl");a(n).insertBefore(t)},_bindEvents:function(){var e=this,t=e.get("vcNumber"),n=function(){},r=function(t){var n=t.input||a(t.currentTarget),r=e.addCommas(n.val());n.val(r);var i=e.get("type"),s=e.get("types");switch(i){case s.cellType:e._renderChineseNumUl();break;case s.wordType:e._renderChineseWords()}};e.set("beforeChange",n),e.set("afterChange",r),t.on("beforeChange",n),t.on("afterChange",r),e.get("$target").on("focus",r);var i=t.get("cls").init,s=t.get("cls").sign,l=e.get("cls");a(document).on("click",function(t){var n=a(t.target);n.hasClass(i)||n.hasClass(l)||n.hasClass(s)||!n.parent()||n.parent().hasClass(s)||e._hideChineseNumUl()})},_hideChineseNumUl:function(){var e=this,t=e.get("$target");t.prev("."+e.get("cls")).fadeOut(.4)},_renderChineseNumUl:function(){var t,n=this,r=n.get("$target"),i=r.prev("."+n.get("cls")),s=["元","十","百","千","万","十","百","千","亿","十","百","千","兆","十","百","千"],l=["角","分"],g=[];a("ul",i).html("");var u=r.val().replace(/\,/g,"");if(u){var o=u.split(".");u=o[0];var c=o[1];if(t=a("li",i).length,u.length+1>t){for(var d=s.slice(t,u.length+1).reverse(),m=[],h=0;h<d.length;h++)m.push("元"==d[h]?'<li style="border-right:none"><div>'+d[h]+"</div><strong></strong></li>":"<li><div>"+d[h]+"</div><strong></strong></li>");a("ul",i).prepend(m.join("")),e.each(e.makeArray(a("li",i)).reverse(),function(e,t){t&&t%3==0&&a(e).addClass("separator")})}if(c&&g.length<2){for(var v=0;v<c.length;v++)g.push('<li style="border-left:2px solid '+n.get("borderColor")+';border-right:none;" class="J_PriceDot"><div>'+l[v]+"</div><strong></strong></li>");a("ul",i).append(g.join(""))}var p=a("strong",i);if(p.html("").removeClass("yen"),c){a(p[p.length-u.length-c.length-1]).html("&yen;").addClass("yen");for(var f=0;f<u.length;f++)a(p[p.length-u.length-c.length+f]).html(u.charAt(f));for(var v=0;v<c.length;v++)a(p[p.length-c.length+v]).html(c.charAt(v))}else a(p[p.length-u.length-1]).html("&yen;").addClass("yen"),e.each(u,function(e,t){a(p[p.length-u.length+t]).html(e)});i.fadeIn(.4),i.width(30*i.children().children().length)}},_renderChineseWords:function(){var e=this,t=e.get("$target"),n=t.prev("."+e.get("cls")),a=e.toCnNumber(t.val());n.replaceClass(e.get("cellMoneyCls"),e.get("cnMoneyCls")),n.html(a+'<span class="unit">元</span>'),n.width(20*(a.length+1)),n.fadeIn(.4)},toCnNumber:function(e){var t=this,n=t._resetNum(e);return t._tempChinese(n)},_tempChinese:function(e){for(var t=new Array("零","壹","贰","叁","肆","伍","陆","柒","捌","玖"),n=new Array("","拾","佰","仟","万","亿","点",""),a=(""+e).replace(/(^0*)/g,"").split("."),r=0,i="",s=a[0].length-1;s>=0;s--){switch(r){case 0:i=n[7]+i;break;case 4:new RegExp("0{4}\\d{"+(a[0].length-s-1)+"}$").test(a[0])||(i=n[4]+i);break;case 8:i=n[5]+i,n[7]=n[5],r=0}r%4==2&&"0"==a[0].charAt(s)&&"0"!=a[0].charAt(s+1)&&(i=t[0]+i),0!=a[0].charAt(s)&&(i=t[a[0].charAt(s)]+n[r%4]+i),r++}if(a.length>1){i+=n[6];for(var s=0;s<a[1].length;s++)i+=t[a[1].charAt(s)]}return i},_resetNum:function(e){var t,n=e.replace(/(\s+)|,/g,"").replace(/(\.+)/g,".").replace(/\,/g,"");return t=/^(\d*)?\d+(\.?)(\d?)(\d?)$/.test(n)?n:!1},addCommas:function(e){var t=this,n=t._resetNum(e);if(!n)return"";n+="";for(var a=n.split("."),r=a[0],i=a.length>1?"."+a[1]:"",s=/(\d+)(\d{3})/;s.test(r);)r=r.replace(s,"$1,$2");return r+i}},{ATTRS:{pluginId:{value:"amountInWords"},type:{value:"inCells"},types:{value:{cellType:"inCells",wordType:"inWords"}},cls:{value:"J_CnMoney"},cnMoneyCls:{value:"cn-money"},cellMoneyCls:{value:"cell-money"},vcNumber:{value:n},beforeChange:{value:n},afterChange:{value:n},moneyTpl:{value:'<div class="J_CnMoney cell-money"><ul></ul></div>'},borderColor:{value:"#fdcc7d"}}})}(),i=function(t){var n=l.all,a=s,i=r,g=new i,u="beforeChange",o="afterChange",c="changing",d=a.extend({initializer:function(){var e=this,t=e.get("$target");e.timer=void 0,e.range=e.get("range"),t.length||e.set("$target",n('input[type="text"]'))},render:function(){var e=this,t=e.get("$target");if(!t.length)return!1;var n=e.get("cls").init;t.hasClass(n)||t.addClass(n),e._addHTML(),e._eventOnChangeNum(),e._eventOnValide()},_isNativeSpinBox:function(){var e=this,t=e.get("$target");return"number"==t.attr("type")?!0:!1},_addHTML:function(){var e=this,t=e.get("$target"),a=e.get("ariaLabel");t.each(function(t){var r=t.parent(),i=n(e.get("outerTpl")),s=n(e.get("plusTpl")),l=n(e.get("minusTpl")),g=n(e.get("rangeTpl"));t.attr({"aria-label":a}),i.append(l).append(t).append(s).append(g),r.append(i)})},_eventOnChangeNum:function(){var t=this,a=t.get("cls"),r=t.get("$target"),i="keyup keydown mouseup mousedown";e.UA.mobile&&(i="touchstart touchend"),r.each(function(r){var s,l=r.siblings("."+a.sign);l.on(i,function(r){var i=n(r.currentTarget),l=i.parent(1),g=l.children("."+a.init),d=Number(e.trim(g.val().replace(/\,/g,""))),m=Number(e.trim(g.attr("data-range")))||t.get("range"),h=1e3,v=0,p=!0,f=function(){var e=r.currentTarget.className;e&&e.indexOf(a.disabled)>-1&&t.set("isLimit",!0),e&&e.indexOf(a.plus)>-1?d+=m:e&&e.indexOf(a.minus)>-1&&(d-=m),p=t.fire(u,{input:g,trigger:i}),t.set("evBack",p),0!=p&&(t._limitRange(d,g,m),t.fire(c,{input:g,trigger:i}))};("keydown"==r.type||"mousedown"==r.type||"touchstart"==r.type)&&(s&&clearTimeout(s),s=setTimeout(function(){console.log(r.type),f(),t.timer&&clearTimeout(t.timer),t.timer=setTimeout(function(){f(),h=150,v++,v>10&&(h=100),t.timer=setTimeout(arguments.callee,h)},h)},10)),("keyup"==r.type||"mouseup"==r.type||"touchend"==r.type)&&setTimeout(function(){console.log(r.type),clearTimeout(t.timer),v=0,0==t.get("evBack")||t.get("isLimit")||t.fire(o,{input:g,trigger:i,range:t.range})},10)})}),r.on("keydown keyup",function(a){var r=n(a.currentTarget),i=Number(e.trim(r.val().replace(/\,/g,""))),s=Number(e.trim(r.attr("data-range")))||t.get("range"),l=!0,g=function(){38===a.keyCode?i+=s:40===a.keyCode&&(i-=s),l=t.fire(u,{input:r,trigger:a.keyCode}),t.set("evBack",l),0!=l&&(t._limitRange(i,r,s),t.fire(c,{input:r,trigger:a.keyCode}))};if((38===a.keyCode||40===a.keyCode)&&("keydown"==a.type&&g(),"keyup"==a.type)){if(0==t.get("evBack")||t.get("isLimit"))return;t.fire(o,{input:r,trigger:a.keyCode,range:t.range})}}),t.get("showRange")&&t.on(o,function(e){var n,r=e.input,i=e.trigger,s=e.range,l=r.siblings("."+a.range);i.hasClass&&i.hasClass(a.plus)||38==i?n="+":(i.hasClass&&i.hasClass(a.minus)||40==i)&&(n="-"),!t.get("isLimit")&&n&&(l.html(n+s).show(),setTimeout(function(){l.addClass(a.slideout)},50),setTimeout(function(){l.hide().removeClass(a.slideout)},500))})},_eventOnValide:function(){var t,a=this,r=a.get("$target");r.each(function(i){i.on("focus",function(){t=n(this).val()}),i.on("blur",function(){var t=n(this),i=Number(e.trim(t.attr("data-range")))||a.get("range");a._formatNum(t),a._limitRange(Number(e.trim(t.val())),t,i),a.timer&&clearTimeout(a.timer),0==a.get("evBack")||a.get("isLimit")||a.fire(o,{input:r,trigger:t,range:a.get("range")})})})},_toFloat:function(e){return parseFloat(e)},_formatNum:function(e){var t=this,n=Number(e.attr("data-min"))||t.get("min"),a=t._toFloat(e.val().replace(/[^\d\.]/g,"").replace(/^0+/,"").replace(/\,/g,""));a=isNaN(a)?n:Math.max(a,n);var r=e.attr("data-hasdecimal")||t.get("hasDecimal").toString(),i="true"==r?2:0;e.val(a.toFixed(i))},_limitRange:function(e,t,a){var r=this,i=t,s=i.parent(1),l=r._toFloat,u=r.get("cls"),o=l(i.attr("data-min"))||r.get("min"),c=l(i.attr("data-max"))||r.get("max"),d=i.attr("data-hasdecimal")||r.get("hasDecimal").toString(),m=o&&Math.max(o,e);m=c&&Math.min(c,m);var h="true"==d?2:0,v=m.toFixed(h),p=i.attr("data-cn");p&&(v=g.addCommas(v)),i.val(v),m===o?(r.range=a-o+e,n("."+u.minus,s).addClass(u.disabled),n("."+u.plus,s).removeClass(u.disabled)):m===c?(r.range=a-e+c,n("."+u.plus,s).addClass(u.disabled),n("."+u.minus,s).removeClass(u.disabled)):(n("."+u.sign,s).removeClass(u.disabled),r.set("isLimit",!1),r.range=a)}},{ATTRS:{$target:{value:"",getter:function(e){return n(e)}},min:{value:Number.MIN_VALUE},max:{value:Number.MAX_VALUE},range:{value:1},showRange:{value:!1},hasDecimal:{value:!1},isLimit:{value:!1},evBack:{value:!0},cls:{value:{init:"vc-number",sign:"vc-number-sign",plus:"vc-number-plus",minus:"vc-number-minus",container:"vc-plus-minus-operation",disabled:"vc-number-disabled",range:"vc-number-range-icon",slideout:"slideout"}},outerTpl:{value:'<span class="{container}"></span>',getter:function(t){var n=this,a=n.get("cls");return e.substitute(t,{container:a.container})}},plusTpl:{value:'<a href="#!/plus" class="{plus} {sign}" role="button"><span class="{plus}-sign">+</span></a>',getter:function(t){var n=this,a=n.get("cls");return e.substitute(t,{plus:a.plus,sign:a.sign})}},minusTpl:{value:'<a href="#!/minus" class="{minus} {sign}"  role="button"><span class="{minus}-sign">-</span></a>',getter:function(t){var n=this,a=n.get("cls");return e.substitute(t,{minus:a.minus,sign:a.sign})}},rangeTpl:{value:'<p class="vc-number-range-icon"></p>'},ariaLabel:{value:"出价框，请输入价格"}}});return t=d}(),a.exports=i});